<!DOCTYPE html>
<html lang="en" ng-app="docs">
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    
      <title>Adding Custom Business Logic with Events - Deployd Docs</title>
    
    <link href='http://fonts.googleapis.com/css?family=Bitter:400,700,400italic' rel='stylesheet' type='text/css'>
    <link href="../../stylesheets/style.css" rel='stylesheet' type='text/css'>
    <link href="../../stylesheets/prettify.css" rel='stylesheet' type='text/css'>
    <script src="../../javascripts/libs/angular.js"></script>
    <script src="../../javascripts/libs/angular-sanitize.js"></script>
    <script src="../../javascripts/libs/jquery-1.8.2.js"></script>
    <script src="../../javascripts/libs/bootstrap.js"></script>
    <script src="../../javascripts/libs/jquery.highlight.js"></script>
    <script src="../../javascripts/libs/jquery.masonry.js"></script>
    <script src="../../javascripts/libs/prettify.js"></script>
    
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-27539606-3']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
  </head>
  
  
  <body>
    <div class="navbar navbar-static-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="brand" href="http://deployd.com">
            <img src="http://deployd.com/img/logo-text.png">
          </a>
          <div class="nav-collapse">
            <ul class="nav">
              <!--<li><a href="http://cloud.deployd.com">cloud</a></li>-->
              <li class="active"><a href="http://docs.deployd.com">docs</a></li>
              <li><a href="http://deployd.com/community.html">community</a></li>
              <li><a href="http://deployd.com/blog.html">blog</a></li>
            </ul>
          </div><!--/.nav-collapse -->
          
          <div id="search" ng-controller="SearchCtrl" class="pull-right">
  <form class="navbar-search">
    <input value="" placeholder="search docs" id="search-input" type="text" ng-change="change()" ng-model="input" />
  </form>
  <ul id="search-terms" class="typeahead unstyled" ng-show="terms.length" ng-cloak>
    <li ng-repeat="term in terms" class="{{ term.active && 'active' }}" ng-click="choose($index)">
      {{ term.title || term.reference }}
    </li>
  </ul>
</div>

<script src="../../javascripts/search.js"></script>
          
          <div id="social" class="nav-collapse pull-left">
            <ul class="nav">
              <li><iframe allowtransparency="true" frameborder="0" scrolling="no" src="http://platform.twitter.com/widgets/tweet_button.1354270846.html#_=1354747685285&count=horizontal&id=twitter-widget-0&lang=en&original_referer=http:/deployd.com/&size=m&text=Deployd%20Platform%20(@deploydapp)%20-%20The%20simplest%20way%20to%20build%20APIs.&url=http:/www.deployd.com" class="twitter-share-button twitter-count-horizontal" style="width: 107px; height: 20px;" title="Twitter Tweet Button" data-twttr-rendered="true"></iframe>
      <script type="text/javascript" async="" src="http://www.google-analytics.com/ga.js"></script><script id="twitter-wjs" src="http://platform.twitter.com/widgets.js"></script><script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script></li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <div class="navbar navbar-static-top secondary-nav">
      <div class="navbar-inner">
        <div class="container">
          <ul class="nav">        
            <li class=""><a href="../../index.html">home</a></li>
            <li class="" ><a href="../../guides.html">guides</a></li>
            <li class=""><a href="../../api.html">api</a></li>
            <li class=""><a href="../../examples/index.html">examples</a></li>
            <li class=""><a href="../../modules.html">modules</a></li>
          </ul>
        </div>
      </div>
    </div>

    <div class="container">
      

<ul id="breadcrumb" class="unstyled">

  <li><a href="../../index.html">Docs</a><span>/</span></li>

  <li>Collections</li>
  
  <li>(<a href="../collections-include=all.html">View All</a>)</li>
  
</ul>

<div id="browser" class="row">
  <div id="sidebar" class="span3">
    

<div id="explorer">
  <ul id="files" class="nav">
    
      <li class=""><a href="creating-collections.md.html"><i class="icon-file"></i> <span>Creating Collections</span></a></li>
    
      <li class=""><a href="accessing-collections.md.html"><i class="icon-file"></i> <span>Accessing Collections with dpd.js</span></a></li>
    
      <li class="active"><a href="adding-logic.md.html"><i class="icon-file"></i> <span>Adding Custom Business Logic with Events</span></a></li>
    
      <li class=""><a href="relationships-between-collections.md.html"><i class="icon-file"></i> <span>Relationships Between Collections with Events</span></a></li>
    
      <li class=""><a href="notifying-clients.md.html"><i class="icon-file"></i> <span>Notifying the Client of Changes with Messages</span></a></li>
    
    
  </ul>
  
  <ul id="dirs" class="nav">
  
      <li class=""><a href="advanced-guides/custom-client.md.html"><i class="icon-folder-close"></i> <span>Advanced Guides</span></a></li>
    
      <li class=""><a href="reference/event-api.md.html"><i class="icon-folder-close"></i> <span>Reference</span></a></li>
    
      <li class=""><a href="examples/a-simple-todo-app.md.html"><i class="icon-folder-close"></i> <span>Examples</span></a></li>
    
  </ul>
  
</div>


    
      <h4>Related APIs</h4>
      <div id="related-apis">
        <div id="api">
  
      
        
            <ul class="nav nav-list collections">
              <li class="nav-header"><a href="reference/event-api.md.html">Event API</a></li>
            
      <li><a href="reference/event-api.md.html#s-this-764">this</a></li>
    
      <li><a href="reference/event-api.md.html#s-me-764">me</a></li>
    
      <li><a href="reference/event-api.md.html#s-isMe()-764">isMe()</a></li>
    
      <li><a href="reference/event-api.md.html#s-query-764">query</a></li>
    
      <li><a href="reference/event-api.md.html#s-cancel()-764">cancel()</a></li>
    
      <li><a href="reference/event-api.md.html#s-cancelIf(),%20cancelUnless()-764">cancelIf(), cancelUnless()</a></li>
    
      <li><a href="reference/event-api.md.html#s-error()-764">error()</a></li>
    
      <li><a href="reference/event-api.md.html#s-errorIf(),%20errorUnless()-764">errorIf(), errorUnless()</a></li>
    
      <li><a href="reference/event-api.md.html#s-hide()-764">hide()</a></li>
    
      <li><a href="reference/event-api.md.html#s-protect()-764">protect()</a></li>
    
      <li><a href="reference/event-api.md.html#s-changed()-764">changed()</a></li>
    
      <li><a href="reference/event-api.md.html#s-previous-764">previous</a></li>
    
      <li><a href="reference/event-api.md.html#s-emit()-764">emit()</a></li>
    
      <li><a href="reference/event-api.md.html#s-internal-764">internal</a></li>
    
      <li><a href="reference/event-api.md.html#s-isRoot-764">isRoot</a></li>
    
      <li><a href="reference/event-api.md.html#s-console.log()-764">console.log()</a></li>
    
            </ul>
            
            <ul class="nav nav-list collections">
              <li class="nav-header"><a href="reference/querying-collections.md.html">Querying Collections</a></li>
            
      <li><a href="reference/querying-collections.md.html#s-Comparison%20($gt,%20$lt,%20$gte,%20$lte)-1556">Comparison ($gt, $lt, $gte, $lte)</a></li>
    
      <li><a href="reference/querying-collections.md.html#s-$ne%20(Not%20Equal)-1556">$ne (Not Equal)</a></li>
    
      <li><a href="reference/querying-collections.md.html#s-$in-1556">$in</a></li>
    
      <li><a href="reference/querying-collections.md.html#s-$regex-1556">$regex</a></li>
    
      <li><a href="reference/querying-collections.md.html#s-$fields-1416">$fields</a></li>
    
      <li><a href="reference/querying-collections.md.html#s-$or-1416">$or</a></li>
    
      <li><a href="reference/querying-collections.md.html#s-$sort-1416">$sort</a></li>
    
      <li><a href="reference/querying-collections.md.html#s-$limit-1416">$limit</a></li>
    
      <li><a href="reference/querying-collections.md.html#s-$skip-1416">$skip</a></li>
    
      <li><a href="reference/querying-collections.md.html#s-$limitRecursion-1416">$limitRecursion</a></li>
    
            </ul>
            
            <ul class="nav nav-list collections">
              <li class="nav-header"><a href="reference/updating-objects.md.html">Updating Objects in Collections</a></li>
            
      <li><a href="reference/updating-objects.md.html#s-$inc-3004">$inc</a></li>
    
      <li><a href="reference/updating-objects.md.html#s-$push-3004">$push</a></li>
    
      <li><a href="reference/updating-objects.md.html#s-$pushAll-3004">$pushAll</a></li>
    
      <li><a href="reference/updating-objects.md.html#s-$pull-3004">$pull</a></li>
    
      <li><a href="reference/updating-objects.md.html#s-$pullAll-3004">$pullAll</a></li>
    
            </ul>
            
            <ul class="nav nav-list collections">
              <li class="nav-header"><a href="reference/dpd-js.md.html">Using dpd.js</a></li>
            
      <li><a href="reference/dpd-js.md.html#s-.get(%5Bid%5D,%20%5Bquery%5D,%20fn)-1286">.get([id], [query], fn)</a></li>
    
      <li><a href="reference/dpd-js.md.html#s-.post(%5Bid%5D,%20object,%20fn)">.post([id], object, fn)</a></li>
    
      <li><a href="reference/dpd-js.md.html#s-.put(%5Bid%20or%20query%5D,%20object,%20fn)">.put([id or query], object, fn)</a></li>
    
      <li><a href="reference/dpd-js.md.html#s-.del(id%20or%20query,%20fn)">.del(id or query, fn)</a></li>
    
      <li><a href="reference/dpd-js.md.html#s-dpd.on(message,%20fn)-1069">dpd.on(message, fn)</a></li>
    
      <li><a href="reference/dpd-js.md.html#s-dpd.off(message,%20%5Bfn%5D)-1069">dpd.off(message, [fn])</a></li>
    
      <li><a href="reference/dpd-js.md.html#s-dpd.once(message,%20fn)-1069">dpd.once(message, fn)</a></li>
    
      <li><a href="reference/dpd-js.md.html#s-dpd.socketReady(fn)-1069">dpd.socketReady(fn)</a></li>
    
      <li><a href="reference/dpd-js.md.html#s-dpd.socket-1069">dpd.socket</a></li>
    
            </ul>
            
      
    
</div>




      </div>
    
  </div>
  <div class="span9 sections">
    
      

  <div class="section"><a name="s-Adding Custom Business Logic with Events"></a><h2>Adding Custom Business Logic with Events <a class="anchor-link" href="adding-logic.md.html#s-Adding%20Custom%20Business%20Logic%20with%20Events">#</a></h2>

<p>Events allow you to add custom business logic to your Collection. By writing Events, you can add validation, relationships, and security to your app. Events are written in JavaScript (specifically, the ECMAScript 5 standard) and have access to the <a href="reference/event-api.md.html">Collection Events API</a>.</p>

<p>The following events are available for scripting:</p><div class="section"><a name="s-On Get-3789"></a><h3>On Get <a class="anchor-link" href="adding-logic.md.html#s-On%20Get-3789">#</a></h3>

<p>Called whenever an object is loaded from the server. Commonly used to hide properties, restrict access to private objects, and calculate dynamic values.</p>

<pre><code>// Example On Get: Hide Secret Properties
if (!me || me.id !== this.creatorId) {
  hide('secret');
}
</code></pre>

<!--seperate-->

<pre><code>// Example On Get: Load A Post's Comments
if (query.loadComments) {
  dpd.comments.get({postId: this.id}, function(comments) {
    this.comments = comments;
  });  
}
</code></pre>

<p><em>Note: When a list of objects is loaded, <code>On Get</code> will run once for each object in the list. Calling <code>cancel()</code> in this case will remove the object from the list, rather than cancelling the entire request.</em></p></div><div class="section"><a name="s-On Validate -3789"></a><h3>On Validate  <a class="anchor-link" href="adding-logic.md.html#s-On%20Validate%20-3789">#</a></h3>

<p>Called whenever an object's values change, including when it is first created. Commonly used to validate property values and calculate certain dynamic values (i.e. last modified time). </p>

<pre><code>// Example On Validate: Enforce a max length
if (this.body.length &gt; 100) {
  error('body', "Cannot be more than 100 characters");
}
</code></pre>

<!--seperate-->

<pre><code>// Example On Validate: Normalize an @handle
if (this.handle.indexOf('@') !== 0) {
  this.handle = '@' + this.handle;
}
</code></pre>

<p><em>Note: <code>On Post</code> or <code>On Put</code> will execute after <code>On Validate</code>, unless <code>cancel()</code> or <code>error()</code> is called</em></p></div><div class="section"><a name="s-On Post-3789"></a><h3>On Post <a class="anchor-link" href="adding-logic.md.html#s-On%20Post-3789">#</a></h3>

<p>Called when an object is created. Commonly used to prevent unauthorized creation and save data relevant to the creation of an object, such as its creator.</p>

<pre><code>// Example On Post: Save the date created
this.createdDate = new Date().getTime();
</code></pre>

<!--seperate-->

<pre><code>// Example On Post: Prevent unauthorized users from posting
if (!me) {
  cancel("You must be logged in", 401);
}
</code></pre></div><div class="section"><a name="s-On Put-3789"></a><h3>On Put <a class="anchor-link" href="adding-logic.md.html#s-On%20Put-3789">#</a></h3>

<p>Called when an object is updated. Commonly used to restrict editing access to certain roles, or to protect certain properties from editing. It is strongly recommended that you <code>protect()</code> any properties that should not be modifiable by users after an object is created.</p>

<pre><code>// Example On Put: Protect readonly/automatic properties
protect('createdDate');
protect('creatorId');
</code></pre></div><div class="section"><a name="s-On Delete -3789"></a><h3>On Delete  <a class="anchor-link" href="adding-logic.md.html#s-On%20Delete%20-3789">#</a></h3>

<p>Called when an object is deleted. Commonly used to prevent unauthorized deletion.</p>

<pre><code>// Example On Delete: Prevent non-admins from deleting
if (!me || me.role !== 'admin') {
  cancel("You must be an admin to delete this", 401);
}
</code></pre></div></div>  

    
    <h3 style="text-align: center;">More</h3>

    
    
    <div class="row-fluid">
      <div class="span6">
        <div class="well">
          <h4>Other docs in "Collections"</h4>
          <ul>
            
              <li><a href="creating-collections.md.html">Creating Collections</a></li>
            
              <li><a href="accessing-collections.md.html">Accessing Collections with dpd.js</a></li>
            
              <li><a href="relationships-between-collections.md.html">Relationships Between Collections with Events</a></li>
            
              <li><a href="notifying-clients.md.html">Notifying the Client of Changes with Messages</a></li>
            
              <li><a href="advanced-guides/custom-client.md.html">Advanced Guides</a></li>
            
              <li><a href="reference/event-api.md.html">Reference</a></li>
            
              <li><a href="examples/a-simple-todo-app.md.html">Examples</a></li>
            
          </ul>
        </div>
      </div>
       
        <div class="span6">
          <div class="well">
            <h4>Related Examples</h4>
            <ul>
              
                <li><a href="examples/a-simple-todo-app.md.html">A Simple Todo App</a></li>
              
                <li><a href="examples/a-simple-todo-app-with-angular.md.html">A Simple Todo App with AngularJS</a></li>
              
                <li><a href="examples/a-simple-todo-app-with-backbone.md.html">A Simple Todo App with Backbone.js</a></li>
              
                <li><a href="examples/chatroom.md.html">Chatroom</a></li>
              
            </ul>
          </div>
        </div>
      
    </div>
  </div>
</div>
    </div>
    
    <div class="docs-nav">
      <div class="container">
        <div class="row">
          <div class="span3">
            <h3>Guides</h3>
            <ul class="nav nav-list">
              
                <li><a href="../getting-started/what-is-deployd.md.html">Getting Started</a></li>
              
                <li><a href="../basics/cli.md.html">Basics</a></li>
              
                <li><a href="creating-collections.md.html">Collections</a></li>
              
                <li><a href="../users/creating-user-collections.md.html">Users</a></li>
              
                <li><a href="../using-modules/installing-modules.md.html">Using Modules</a></li>
              
                <li><a href="../server/as-a-node-module.md.html">The Deployd Server</a></li>
              
                <li><a href="../developing-modules/creating-modules.md.html">Developing Modules</a></li>
              
            </ul>
          </div>
          <div class="span3">
            <h3>APIs</h3>
            <ul class="nav nav-list">
              
                <li class="nav-header"><a href="reference/event-api.md.html">Collections</a></li>
                
                  <li><a href="reference/event-api.md.html">Event API</a></li>
                
                  <li><a href="reference/http.md.html">Over HTTP</a></li>
                
                  <li><a href="reference/querying-collections.md.html">Querying Collections</a></li>
                
                  <li><a href="reference/updating-objects.md.html">Updating Objects in Collections</a></li>
                
                  <li><a href="reference/dpd-js.md.html">Using dpd.js</a></li>
                
              
                <li class="nav-header"><a href="../using-modules/reference/dpd-js.md.html">Using Modules</a></li>
                
                  <li><a href="../using-modules/reference/dpd-js.md.html">Dpd.js for Custom Resources</a></li>
                
                  <li><a href="../using-modules/reference/event-api.md.html">Event API for Custom Resources</a></li>
                
              
                <li class="nav-header"><a href="../developing-modules/internal-api/collection.md.html">Developing Modules</a></li>
                
                  <li><a href="../developing-modules/internal-api/collection.md.html">Collection Resource Type</a></li>
                
                  <li><a href="../developing-modules/internal-api/context.md.html">Context</a></li>
                
                  <li><a href="../developing-modules/internal-api/script.md.html">Event Scripts</a></li>
                
                  <li><a href="../developing-modules/internal-api/internal-client.md.html">Internal Client</a></li>
                
                  <li><a href="../developing-modules/internal-api/resource.md.html">Resource Types</a></li>
                
                  <li><a href="../developing-modules/internal-api/server.md.html">Server</a></li>
                
                  <li><a href="../developing-modules/internal-api/session.md.html">Session</a></li>
                
                  <li><a href="../developing-modules/internal-api/session-store.md.html">Session Store</a></li>
                
                  <li><a href="../developing-modules/internal-api/store.md.html">Store</a></li>
                
                
            </ul>
          </div>
          <div class="span3">
            <h3>Examples</h3>
            <ul class="nav nav-list">
              
                <li class="nav-header"><a href="creating-collections.md.html">Collections</a></li>
                
                  <li><a href="../../index.html">A Simple Todo App</a></li>
                
                  <li><a href="../../index.html">A Simple Todo App with AngularJS</a></li>
                
                  <li><a href="../../index.html">A Simple Todo App with Backbone.js</a></li>
                
                  <li><a href="../../index.html">Chatroom</a></li>
                
              
                <li class="nav-header"><a href="../users/creating-user-collections.md.html">Users</a></li>
                
                  <li><a href="../../index.html">Microblogging app</a></li>
                
                  <li><a href="../../index.html">Simple Login Form</a></li>
                
              
                <li class="nav-header"><a href="../developing-modules/creating-modules.md.html">Developing Modules</a></li>
                
                  <li><a href="../../index.html">Email Resource</a></li>
                
                  <li><a href="../../index.html">Event Resource</a></li>
                
                  <li><a href="../../index.html">S3 Bucket Resource</a></li>
                
                
            </ul>
          </div>
          <div class="span3">
            <div id="feedback">
              <h3>Feedback</h3>
              <p>Let us know if you have any ideas to improve our docs. Open an <a href="https://github.com/deployd/docs/issues">issue on github</a>, <a href="mailto: hello@deployd.com">send us an email</a>, or <a href="https://twitter.com/deploydapp">tweet us</a>.</p>
            </div>
            <div id="download">
              <h3>Edit or Download these Docs</h3>
              <p>This entire site, including documentation written in markdown is <a href="https://github.com/deployd/docs">available on github</a>. Pull requests are appreciated!</p>
            </div>
          </div>
        </div>
      </div>
    </div>
    <footer>
      <div class="container">
        <div class="row">
          <div class="span navigation">
            <dl>
              <dt><img src="http://deployd.com/img/footer-dt.png" alt="deployd"></dt>
              <dd><a href="http://deployd.com/">Home</a></dd>
              <dd><a href="http://deployd.com/video.html">Screencast</a></dd>
              <dd><a href="http://deployd.com/features.html">Features</a></dd>
              <dd><a href="https://github.com/deployd/deployd/issues">Support</a></dd>
            </dl>
            <dl>
              <dt>documentation</dt>
              <dd><a href="http://docs.deployd.com/guides">Guides</a></dd>
              <dd><a href="http://docs.deployd.com/api">API</a></dd>
              <dd><a href="http://docs.deployd.com/examples">Examples</a></dd>
              <dd><a href="http://docs.deployd.com/modules">Modules</a></dd>
            </dl>
            <dl>
              <dt>community</dt>
              <dd><a href="http://deployd.com/community.html">Questions</a></dd>
              <dd><a href="https://twitter.com/deploydapp">Tweets</a></dd>
              <dd><a href="https://github.com/deployd/deployd/issues">Issues</a></dd>
              <dd><a href="https://github.com/deployd/deployd">Github</a></dd>
            </dl>
            <dl>
              <dt>contact</dt>
              <dd><a href="mailto:hello@deployd.com">hello@deployd.com</a></dd>
            </dl>
          </div>
          <div class="span logo-container">
            <div class="logo">
              <img src="http://deployd.com/img/footer-logo.png" alt="deployd">
            </div>
          </div>
          <div class="span email-container">
            <dl id="mc_embed_signup" class="span4">
            <dt>Get deployd emails</dt>
            <dd>
              <form action="http://deployd.us2.list-manage.com/subscribe/post?u=4f1b944ba8c90738eb8e3fa3c&amp;id=7bb18e6b80" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate form-vertical" target="_blank" novalidate="">
              <div class="mc-field-group">
                <input type="email" placeholder="your@email" value="" name="EMAIL" class="required email" id="mce-EMAIL"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button btn">
              </div>
                <div id="mce-responses" class="clear">
                  <div class="response" id="mce-error-response" style="display:none"></div>
                  <div class="response" id="mce-success-response" style="display:none"></div>
                </div>
              </form>
            </dd>
          </dl>
          </div>
        </div>
      </div>
    </footer>
    <script src="../../javascripts/app.js"></script>
  </body>
</html>